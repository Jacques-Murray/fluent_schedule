name: Publish to crates.io

on:
  # Trigger the workflow only when a new tag starting with 'v' is pushed
  push:
    tags:
      - "v*.*.*" # e.g., v0.1.0, v1.2.3

jobs:
  publish:
    name: Build and Publish
    runs-on: ubuntu-latest

    steps:
      # 1. Get the repository code
      - name: Checkout repository
        uses: actions/checkout@v4

      # 2. Install the Rust toolchain
      - name: Install Rust
        uses: dtolnay/rust-toolchain@stable

      # 3. Publish to crates.io
      # This step uses the secret token you added to GitHub
      - name: Publish to crates.io
        run: cargo publish
        env:
          CARGO_REGISTRY_TOKEN: ${{ secrets.CARGO_REGISTRY_TOKEN }}
